import { z } from "zod";
<<<<<<< HEAD
import { emitESMImage } from "../assets/utils/emitAsset.js";
function createImage(pluginContext, entryFilePath) {
  return () => {
    return z.string().transform(async (imagePath, ctx) => {
      var _a;
      const resolvedFilePath = (_a = await pluginContext.resolve(imagePath, entryFilePath)) == null ? void 0 : _a.id;
      const metadata = await emitESMImage(
        resolvedFilePath,
        pluginContext.meta.watchMode,
        pluginContext.emitFile
=======
import { emitESMImage } from "../assets/utils/node/emitAsset.js";
function createImage(pluginContext, shouldEmitFile, entryFilePath, experimentalSvgEnabled) {
  return () => {
    return z.string().transform(async (imagePath, ctx) => {
      const resolvedFilePath = (await pluginContext.resolve(imagePath, entryFilePath))?.id;
      const metadata = await emitESMImage(
        resolvedFilePath,
        pluginContext.meta.watchMode,
        // FUTURE: Remove in this in v6
        experimentalSvgEnabled,
        shouldEmitFile ? pluginContext.emitFile : void 0
>>>>>>> 08f40ceb (Initial)
      );
      if (!metadata) {
        ctx.addIssue({
          code: "custom",
          message: `Image ${imagePath} does not exist. Is the path correct?`,
          fatal: true
        });
        return z.never();
      }
<<<<<<< HEAD
      return metadata;
=======
      return { ...metadata, ASTRO_ASSET: metadata.fsPath };
>>>>>>> 08f40ceb (Initial)
    });
  };
}
export {
  createImage
};
