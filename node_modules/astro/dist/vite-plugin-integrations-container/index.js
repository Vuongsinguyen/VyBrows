import { normalizePath } from "vite";
<<<<<<< HEAD
import { runHookServerSetup } from "../integrations/index.js";
function astroIntegrationsContainerPlugin({
  settings,
  logging
=======
import { runHookServerSetup } from "../integrations/hooks.js";
function astroIntegrationsContainerPlugin({
  settings,
  logger
>>>>>>> 08f40ceb (Initial)
}) {
  return {
    name: "astro:integration-container",
    async configureServer(server) {
<<<<<<< HEAD
      if (server.config.isProduction)
        return;
      await runHookServerSetup({ config: settings.config, server, logging });
    },
    async buildStart() {
      if (settings.injectedRoutes.length === settings.resolvedInjectedRoutes.length)
        return;
=======
      if (server.config.isProduction) return;
      await runHookServerSetup({ config: settings.config, server, logger });
    },
    async buildStart() {
      if (settings.injectedRoutes.length === settings.resolvedInjectedRoutes.length) return;
>>>>>>> 08f40ceb (Initial)
      settings.resolvedInjectedRoutes = await Promise.all(
        settings.injectedRoutes.map((route) => resolveEntryPoint.call(this, route))
      );
    }
  };
}
async function resolveEntryPoint(route) {
<<<<<<< HEAD
  const resolvedId = await this.resolve(route.entryPoint).then((res) => res == null ? void 0 : res.id).catch(() => void 0);
  if (!resolvedId)
    return route;
=======
  const resolvedId = await this.resolve(route.entrypoint.toString()).then((res) => res?.id).catch(() => void 0);
  if (!resolvedId) return route;
>>>>>>> 08f40ceb (Initial)
  const resolvedEntryPoint = new URL(`file://${normalizePath(resolvedId)}`);
  return { ...route, resolvedEntryPoint };
}
export {
  astroIntegrationsContainerPlugin as default
};
