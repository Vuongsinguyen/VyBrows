function createPluginContainer(options, internals) {
<<<<<<< HEAD
  const clientPlugins = [];
  const ssrPlugins = [];
  const allPlugins = /* @__PURE__ */ new Set();
=======
  const plugins = /* @__PURE__ */ new Map();
  const allPlugins = /* @__PURE__ */ new Set();
  for (const target of ["client", "server"]) {
    plugins.set(target, []);
  }
>>>>>>> 08f40ceb (Initial)
  return {
    options,
    internals,
    register(plugin) {
      allPlugins.add(plugin);
<<<<<<< HEAD
      switch (plugin.build) {
        case "client": {
          clientPlugins.push(plugin);
          break;
        }
        case "ssr": {
          ssrPlugins.push(plugin);
          break;
        }
        case "both": {
          clientPlugins.push(plugin);
          ssrPlugins.push(plugin);
          break;
        }
      }
    },
    // Hooks
    runBeforeHook(build, input) {
      var _a;
      let plugins = build === "ssr" ? ssrPlugins : clientPlugins;
      let vitePlugins = [];
      let lastVitePlugins = [];
      for (const plugin of plugins) {
        if ((_a = plugin.hooks) == null ? void 0 : _a["build:before"]) {
          let result = plugin.hooks["build:before"]({ build, input });
=======
      for (const target of plugin.targets) {
        const targetPlugins = plugins.get(target) ?? [];
        targetPlugins.push(plugin);
        plugins.set(target, targetPlugins);
      }
    },
    // Hooks
    async runBeforeHook(target, input) {
      let targetPlugins = plugins.get(target) ?? [];
      let vitePlugins = [];
      let lastVitePlugins = [];
      for (const plugin of targetPlugins) {
        if (plugin.hooks?.["build:before"]) {
          let result = await plugin.hooks["build:before"]({ target, input });
>>>>>>> 08f40ceb (Initial)
          if (result.vitePlugin) {
            vitePlugins.push(result.vitePlugin);
          }
        }
      }
      return {
        vitePlugins,
        lastVitePlugins
      };
    },
<<<<<<< HEAD
    async runPostHook(ssrReturn, clientReturn) {
      var _a;
      const mutations = /* @__PURE__ */ new Map();
      const ssrOutputs = [];
      const clientOutputs = [];
      if (Array.isArray(ssrReturn)) {
        ssrOutputs.push(...ssrReturn);
      } else if ("output" in ssrReturn) {
        ssrOutputs.push(ssrReturn);
      }
      if (Array.isArray(clientReturn)) {
        clientOutputs.push(...clientReturn);
      } else if (clientReturn && "output" in clientReturn) {
        clientOutputs.push(clientReturn);
      }
      const mutate = (chunk, build, newCode) => {
        chunk.code = newCode;
        mutations.set(chunk.fileName, {
          build,
=======
    async runPostHook(ssrOutputs, clientOutputs) {
      const mutations = /* @__PURE__ */ new Map();
      const mutate = (chunk, targets, newCode) => {
        chunk.code = newCode;
        mutations.set(chunk.fileName, {
          targets,
>>>>>>> 08f40ceb (Initial)
          code: newCode
        });
      };
      for (const plugin of allPlugins) {
<<<<<<< HEAD
        const postHook = (_a = plugin.hooks) == null ? void 0 : _a["build:post"];
=======
        const postHook = plugin.hooks?.["build:post"];
>>>>>>> 08f40ceb (Initial)
        if (postHook) {
          await postHook({
            ssrOutputs,
            clientOutputs,
            mutate
          });
        }
      }
      return mutations;
    }
  };
}
export {
  createPluginContainer
};
