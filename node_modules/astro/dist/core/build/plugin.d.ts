<<<<<<< HEAD
import type { Plugin as VitePlugin } from 'vite';
import type { BuildInternals } from './internal';
import type { StaticBuildOptions, ViteBuildReturn } from './types';
=======
import type { Rollup, Plugin as VitePlugin } from 'vite';
import type { BuildInternals } from './internal.js';
import type { StaticBuildOptions, ViteBuildReturn } from './types.js';
>>>>>>> 08f40ceb (Initial)
type RollupOutputArray = Extract<ViteBuildReturn, Array<any>>;
type OutputChunkorAsset = RollupOutputArray[number]['output'][number];
type OutputChunk = Extract<OutputChunkorAsset, {
    type: 'chunk';
}>;
<<<<<<< HEAD
type MutateChunk = (chunk: OutputChunk, build: 'server' | 'client', newCode: string) => void;
export type AstroBuildPlugin = {
    build: 'ssr' | 'client' | 'both';
    hooks?: {
        'build:before'?: (opts: {
            build: 'ssr' | 'client';
            input: Set<string>;
        }) => {
            enforce?: 'after-user-plugins';
            vitePlugin: VitePlugin | VitePlugin[] | undefined;
        };
=======
export type BuildTarget = 'server' | 'client';
type MutateChunk = (chunk: OutputChunk, targets: BuildTarget[], newCode: string) => void;
interface BuildBeforeHookResult {
    enforce?: 'after-user-plugins';
    vitePlugin: VitePlugin | VitePlugin[] | undefined;
}
export type AstroBuildPlugin = {
    targets: BuildTarget[];
    hooks?: {
        'build:before'?: (opts: {
            target: BuildTarget;
            input: Set<string>;
        }) => BuildBeforeHookResult | Promise<BuildBeforeHookResult>;
>>>>>>> 08f40ceb (Initial)
        'build:post'?: (opts: {
            ssrOutputs: RollupOutputArray;
            clientOutputs: RollupOutputArray;
            mutate: MutateChunk;
        }) => void | Promise<void>;
    };
};
export declare function createPluginContainer(options: StaticBuildOptions, internals: BuildInternals): {
    options: StaticBuildOptions;
    internals: BuildInternals;
    register(plugin: AstroBuildPlugin): void;
<<<<<<< HEAD
    runBeforeHook(build: 'ssr' | 'client', input: Set<string>): {
        vitePlugins: (VitePlugin | VitePlugin[])[];
        lastVitePlugins: (VitePlugin | VitePlugin[])[];
    };
    runPostHook(ssrReturn: ViteBuildReturn, clientReturn: ViteBuildReturn | null): Promise<Map<string, {
        build: 'server' | 'client';
=======
    runBeforeHook(target: BuildTarget, input: Set<string>): Promise<{
        vitePlugins: (VitePlugin<any> | VitePlugin<any>[])[];
        lastVitePlugins: (VitePlugin<any> | VitePlugin<any>[])[];
    }>;
    runPostHook(ssrOutputs: Rollup.RollupOutput[], clientOutputs: Rollup.RollupOutput[]): Promise<Map<string, {
        targets: BuildTarget[];
>>>>>>> 08f40ceb (Initial)
        code: string;
    }>>;
};
export type AstroBuildPluginContainer = ReturnType<typeof createPluginContainer>;
export {};
