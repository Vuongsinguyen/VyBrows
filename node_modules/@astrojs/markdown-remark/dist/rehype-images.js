import { visit } from "unist-util-visit";
function rehypeImages() {
<<<<<<< HEAD
  return () => function(tree, file) {
    visit(tree, (node) => {
      var _a, _b;
      if (node.type !== "element")
        return;
      if (node.tagName !== "img")
        return;
      if ((_a = node.properties) == null ? void 0 : _a.src) {
        if ((_b = file.data.imagePaths) == null ? void 0 : _b.has(node.properties.src)) {
          node.properties["__ASTRO_IMAGE_"] = node.properties.src;
          delete node.properties.src;
        }
      }
=======
  return function(tree, file) {
    if (!file.data.astro?.localImagePaths?.length && !file.data.astro?.remoteImagePaths?.length) {
      return;
    }
    const imageOccurrenceMap = /* @__PURE__ */ new Map();
    visit(tree, "element", (node) => {
      if (node.tagName !== "img") return;
      if (typeof node.properties?.src !== "string") return;
      const src = decodeURI(node.properties.src);
      let newProperties;
      if (file.data.astro?.localImagePaths?.includes(src)) {
        newProperties = { ...node.properties, src };
      } else if (file.data.astro?.remoteImagePaths?.includes(src)) {
        newProperties = {
          // By default, markdown images won't have width and height set. However, just in case another user plugin does set these, we should respect them.
          inferSize: "width" in node.properties && "height" in node.properties ? void 0 : true,
          ...node.properties,
          src
        };
      } else {
        return;
      }
      const index = imageOccurrenceMap.get(node.properties.src) || 0;
      imageOccurrenceMap.set(node.properties.src, index + 1);
      node.properties = { __ASTRO_IMAGE_: JSON.stringify({ ...newProperties, index }) };
>>>>>>> 08f40ceb (Initial)
    });
  };
}
export {
  rehypeImages
};
