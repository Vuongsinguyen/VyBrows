/**
<<<<<<< HEAD
 * @typedef {import('../types.js').Comment} Comment
 * @typedef {import('../types.js').Parent} Parent
 * @typedef {import('../types.js').State} State
=======
 * @import {Comment, Parents} from 'hast'
 * @import {State} from '../index.js'
>>>>>>> 08f40ceb (Initial)
 */

import {stringifyEntities} from 'stringify-entities'

<<<<<<< HEAD
=======
const htmlCommentRegex = /^>|^->|<!--|-->|--!>|<!-$/g

// Declare arrays as variables so it can be cached by `stringifyEntities`
const bogusCommentEntitySubset = ['>']
const commentEntitySubset = ['<', '>']

>>>>>>> 08f40ceb (Initial)
/**
 * Serialize a comment.
 *
 * @param {Comment} node
 *   Node to handle.
 * @param {number | undefined} _1
 *   Index of `node` in `parent.
<<<<<<< HEAD
 * @param {Parent | undefined} _2
=======
 * @param {Parents | undefined} _2
>>>>>>> 08f40ceb (Initial)
 *   Parent of `node`.
 * @param {State} state
 *   Info passed around about the current state.
 * @returns {string}
 *   Serialized node.
 */
export function comment(node, _1, _2, state) {
  // See: <https://html.spec.whatwg.org/multipage/syntax.html#comments>
  return state.settings.bogusComments
    ? '<?' +
        stringifyEntities(
          node.value,
<<<<<<< HEAD
          Object.assign({}, state.settings.characterReferences, {subset: ['>']})
        ) +
        '>'
    : '<!--' + node.value.replace(/^>|^->|<!--|-->|--!>|<!-$/g, encode) + '-->'
=======
          Object.assign({}, state.settings.characterReferences, {
            subset: bogusCommentEntitySubset
          })
        ) +
        '>'
    : '<!--' + node.value.replace(htmlCommentRegex, encode) + '-->'
>>>>>>> 08f40ceb (Initial)

  /**
   * @param {string} $0
   */
  function encode($0) {
    return stringifyEntities(
      $0,
      Object.assign({}, state.settings.characterReferences, {
<<<<<<< HEAD
        subset: ['<', '>']
=======
        subset: commentEntitySubset
>>>>>>> 08f40ceb (Initial)
      })
    )
  }
}
