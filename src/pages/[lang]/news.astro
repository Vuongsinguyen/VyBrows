---
import '/src/styles/global.css';
import PageLayout from '../../layouts/PageLayout.astro';
import NewsListComp from '../../components/UI/layout/NewsListComp.astro';
import newsData from '../../data/news.json';

export const prerender = true;

export async function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'vi' } },
    { params: { lang: 'ja' } }
  ];
}

const lang = Astro.params.lang;
const PAGE_SIZE = 25;
const pageParam = Astro.url?.searchParams.get('page');
const currentPage = pageParam ? parseInt(pageParam) : 1;

// Get news from JSON data
const news = newsData.news.map((item) => {
  const translation = item.translations[lang as keyof typeof item.translations] || item.translations.en; // Fallback to English
  return {
    id: item.id,
    title: translation.title,
    description: translation.shortDescription,
    image: item.mainImage,
    date: item.createdDate,
    category: 'PMU News', // Default category
    link: `/${lang}/news/${item.id}`,
  };
})
// Sort by date descending (newest first)
.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

const totalNews = news.length;
const totalPages = Math.ceil(totalNews / PAGE_SIZE);
const pagedNews = news.slice((currentPage - 1) * PAGE_SIZE, currentPage * PAGE_SIZE);
---

<PageLayout title="News">
  <section class="py-16 px-6" style="background: var(--color-bg);">
    <div class="max-w-7xl mx-auto">
      <div class="flex gap-8">
        <!-- Sidebar Sticky Left -->
        <div class="hidden md:flex flex-col items-center w-[100px] h-[300px] sticky top-24">
          <span class="inline-block bg-blue-100 text-blue-700 text-xs font-semibold px-3 py-1 rounded-full mb-2">
            TECH
          </span>
        </div>
        <!-- Main Content -->
        <div class="flex-1">
          <NewsListComp news={pagedNews} />
        </div>
      </div>
    </div>
  </section>
</PageLayout>