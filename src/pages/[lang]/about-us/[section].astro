---
import '/src/styles/color.css';
import '/src/styles/global.css';
import PageLayout from '../../../layouts/PageLayout.astro';
import aboutUsData from '../../../content/about-us.json' assert { type: 'json' };

export const prerender = true;

export async function getStaticPaths() {
  const langs = ['vi', 'ja', 'es', 'ko'];
  return langs.flatMap(lang => aboutUsData.sections.map(section => ({ params: { lang, section: section.id } })));
}
const lang = Astro.params.lang as string;
const sectionId = Astro.params.section as string;

// Find current section
const currentSection = aboutUsData.sections.find(section => section.id === sectionId);

// Create section labels for sidebar
const sectionLabels = aboutUsData.sections.reduce((acc, section) => {
  acc[section.id] = (section.title as any)[lang] || section.title.en;
  return acc;
}, {} as Record<string, string>);

// CEO Message HTML component
const ceoMessageHTML = `
<div class="bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg p-8 border-l-4 border-primary shadow-sm" style="border-left-color: var(--color-primary);">
  <h3 class="text-2xl font-bold mb-6" style="color: var(--color-primary);">Message from Our CEO</h3>
  <div class="flex flex-col md:flex-row gap-6 items-start">
    <div class="flex-shrink-0">
      <img 
        src="/images/mem03.avif" 
        alt="Vy Nguyen - CEO & Founder" 
        class="w-32 h-32 rounded-full object-cover shadow-lg"
        style="border: 1px solid var(--color-primary);"
      />
    </div>
    <div class="flex-1">
      <p class="italic text-lg text-gray-700 leading-relaxed mb-4">
        "At VyBrows Academy, we are committed to excellence in permanent makeup artistry and training. 
        Our mission is to empower artists with the skills and confidence to create natural, stunning results 
        that enhance beauty and transform lives."
      </p>
      <div class="text-right">
        <p class="font-bold text-lg" style="color: var(--color-primary);">Vy Nguyen</p>
        <p class="text-gray-600 text-sm">Founder & CEO, VyBrows Academy</p>
      </div>
    </div>
  </div>
</div>
`;

// Insert CEO message only in "Why Choose Us" page - before "20+ Years of Proven Excellence"
let contentWithCEO = (currentSection?.content as any)?.[lang] || currentSection?.content.en || '';
if (contentWithCEO.includes('20+ Years of Proven Excellence') || contentWithCEO.includes('Hơn 13 Năm Xuất Sắc') || contentWithCEO.includes('13年以上の実証された卓越性')) {
  contentWithCEO = contentWithCEO.replace(
    /<div class="bg-gradient-to-r from-amber-50/,
    ceoMessageHTML + '<div class="bg-gradient-to-r from-amber-50'
  );
}

// Get translated breadcrumb labels
const aboutUsLabel = lang === 'vi' ? 'Giới Thiệu' : lang === 'ja' ? '会社情報' : lang === 'es' ? 'Sobre Nosotros' : lang === 'ko' ? '회사 소개' : 'About Us';
const subtitle = lang === 'vi' ? 'Tìm hiểu thêm về VyBrows Academy' : lang === 'ja' ? 'VyBrowsアカデミーについて' : lang === 'es' ? 'Más información sobre VyBrows Academy' : lang === 'ko' ? 'VyBrows Academy에 대해 자세히 알아보기' : 'Learn more about VyBrows Academy';
---

<PageLayout 
  title={currentSection ? ((currentSection.title as any)[lang] || currentSection.title.en) : aboutUsLabel}
  subtitle={subtitle}
  showBreadcrumb={true}
  breadcrumbItems={[
    { href: `/${lang}/about-us`, label: aboutUsLabel },
    { href: `/${lang}/about-us/${sectionId}`, label: sectionLabels[sectionId] || 'Section' }
  ]}
>
<div class="w-full bg-surface flex justify-center">
<div class="w-full max-w-7xl bg-surface flex flex-col lg:flex-row gap-6 items-start px-6 py-8">
      <!-- Left Sidebar -->
      <aside class="w-full lg:w-64 bg-surface rounded-lg lg:mt-0 lg:sticky lg:top-32 z-20 order-1">
        <ul class="rounded-lg overflow-hidden flex flex-col">
          {aboutUsData.sections.map((section, index) => (
            <li>
              <a 
                href={`/${lang}/about-us/${section.id}`} 
                class={`block rounded-none px-3 py-2 font-normal transition-colors flex items-center gap-2 ${section.id === sectionId ? 'font-semibold' : 'hover:text-primary'}`}
                style={section.id === sectionId ? 'color: var(--color-primary);' : 'color: rgba(0, 0, 0, 0.7);'}
              >
                <img src="/images/diamond.svg" alt="" class="w-8 h-8 flex-shrink-0" />
                <span>{(section.title as any)[lang] || section.title.en}</span>
              </a>
            </li>
          ))}
        </ul>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 space-y-12 order-2">
        {currentSection ? (
          <>
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-8">
              {/* Content */}
              <div class="prose prose-lg max-w-none text-on-surface" set:html={contentWithCEO}></div>
            </div>

            {/* Navigation to Other Sections */}
            <div class="bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg p-6">
              <h3 class="text-lg font-bold text-primary mb-4">Explore More About Us</h3>
              <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                {aboutUsData.sections.filter(section => section.id !== sectionId).slice(0, 3).map((section) => (
                  <a 
                    href={`/${lang}/about-us/${section.id}`}
                    class="block p-4 bg-white rounded-lg border border-gray-200 hover:border-primary hover:shadow-md transition-all duration-300 group"
                  >
                    <h4 class="font-semibold text-primary group-hover:text-primary-dark transition-colors mb-2">
                      {(section.title as any)[lang] || section.title.en}
                    </h4>
                    <p class="text-sm text-gray-600 line-clamp-2">
                      Learn more about this aspect of VyBrows Academy...
                    </p>
                    <div class="flex items-center text-primary text-xs font-medium mt-2 group-hover:gap-1 transition-all duration-300">
                      <span>Read More</span>
                      <svg class="w-3 h-3 transform group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                      </svg>
                    </div>
                  </a>
                ))}
              </div>
            </div>

            {/* Call to Action */}
            <div class="bg-primary/10 border border-primary rounded-xl p-6 text-center">
              <h3 class="text-xl font-bold text-primary mb-2">Ready to Start Your Journey?</h3>
              <p class="text-on-surface mb-4">
                Join VyBrows Academy and discover the art of permanent makeup with our expert training programs.
              </p>
              <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a 
                  href={`/${lang}/contact`}
                  class="inline-block px-8 py-3 font-semibold rounded-lg transition-colors"
                  style="background: var(--color-primary); color: #ffffff;"
                >
                  Contact Us
                </a>
                <a 
                  href={`/${lang}/training`}
                  class="inline-block px-8 py-3 font-semibold rounded-lg transition-colors hover:bg-opacity-10"
                  style="border: 2px solid var(--color-primary); color: var(--color-primary);"
                >
                  View Training
                </a>
              </div>
            </div>
          </>
        ) : (
          <div class="text-center py-12">
            <h1 class="text-2xl font-bold text-gray-600 mb-4">Section Not Found</h1>
            <p class="text-gray-500 mb-6">The requested section could not be found.</p>
            <a 
              href={`/${lang}/about-us`}
              class="inline-block px-6 py-3 bg-primary text-white font-semibold rounded-lg hover:bg-primary-dark transition-colors"
            >
              Return to About Us
            </a>
          </div>
        )}
      </main>
    </div>
  </div>
</PageLayout>

<style>
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>