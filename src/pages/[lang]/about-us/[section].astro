---
import '/src/styles/color.css';
import '/src/styles/global.css';
import PageLayout from '../../../layouts/PageLayout.astro';
import aboutUsData from '../../../content/about-us.json' assert { type: 'json' };

export const prerender = true;

export async function getStaticPaths() {
  const langs = ['en', 'vi', 'ja'];
  return langs.flatMap(lang => aboutUsData.sections.map(section => ({ params: { lang, section: section.id } })));
}
const lang = Astro.params.lang as 'en' | 'vi' | 'ja';
const sectionId = Astro.params.section as string;

// Tìm section hiện tại
const currentSection = aboutUsData.sections.find(section => section.id === sectionId);

// Tạo tocLabels động từ JSON
const tocLabels = aboutUsData.sections.reduce((acc, section) => {
  acc[section.id] = section.title[lang] || section.title.en;
  return acc;
}, {} as Record<string, string>);
---

<PageLayout title={currentSection ? (currentSection.title[lang] || currentSection.title.en) : 'About Us'}>
  <div class="w-full bg-surface flex justify-center">
    <div class="w-full max-w-7xl bg-surface flex flex-col lg:flex-row gap-6 items-start px-6 py-8">
      <!-- Left Sidebar -->
      <aside class="w-full lg:w-64 bg-surface rounded-lg lg:mt-0 lg:sticky lg:top-32 z-20 order-1">
        <ul class="rounded-lg overflow-hidden flex flex-col">
          {aboutUsData.sections.map((section, index) => (
            <li>
              <a 
                href={`/${lang}/about-us/${section.id}`} 
                class={`block rounded-none px-3 py-2 font-normal transition-colors flex items-center gap-2 ${section.id === sectionId ? 'font-semibold' : 'hover:text-primary'}`}
                style={section.id === sectionId ? 'color: var(--color-primary);' : 'color: rgba(0, 0, 0, 0.7);'}
              >
                <img src="/images/diamond.svg" alt="" class="w-8 h-8 flex-shrink-0" />
                <span>{section.title[lang] || section.title.en}</span>
              </a>
            </li>
          ))}
        </ul>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 space-y-12 order-2">
        {currentSection ? (
          <>
            <h1 class="text-3xl font-bold mb-4 text-on-surface">{currentSection.title[lang] || currentSection.title.en}</h1>
            <div class="prose prose-lg max-w-none text-on-surface" set:html={currentSection.content[lang] || currentSection.content.en}></div>
          </>
        ) : (
          <div class="text-center py-12">
            <h1 class="text-2xl font-bold text-on-surface mb-4">{lang === 'vi' ? 'Không tìm thấy trang' : lang === 'ja' ? 'ページが見つかりません' : 'Page Not Found'}</h1>
            <p class="text-on-surface">{lang === 'vi' ? 'Trang bạn tìm kiếm không tồn tại.' : lang === 'ja' ? 'お探しのページは存在しません。' : 'The page you are looking for does not exist.'}</p>
          </div>
        )}
      </main>

      <!-- Sidebar Phải: Contact Form -->
      <aside class="hidden lg:block w-[220px] bg-surface-1 rounded-lg p-4 text-on-surface shadow mt-4 lg:mt-0 lg:sticky lg:top-32 z-20 border border-border">
        <form class="space-y-4">
          <h2 class="font-bold text-lg mb-2 text-on-surface">Contact Us</h2>
          <div>
            <label class="block text-sm font-medium mb-1" for="name">Name</label>
            <input class="w-full rounded border border-border p-2 text-on-surface bg-surface-1" type="text" id="name" name="name" required />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1" for="email">Email</label>
            <input class="w-full rounded border border-border p-2 text-on-surface bg-surface-1" type="email" id="email" name="email" required />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1" for="message">Message</label>
            <textarea class="w-full rounded border border-border p-2 text-on-surface bg-surface-1" id="message" name="message" rows="4" required></textarea>
          </div>
          <button type="submit" class="w-full bg-primary text-on-primary rounded-lg p-3 font-semibold shadow-none hover:opacity-90 transition">Send</button>
        </form>
      </aside>
    </div>
  </div>
</PageLayout>