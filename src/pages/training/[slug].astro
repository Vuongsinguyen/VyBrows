---
import '/src/styles/color.css';
import '/src/styles/global.css';
import NewsLayout from '../../layouts/NewsLayout.astro';
import BannerFix from '../../components/UI/section/BannerFix.astro';
import trainingData from '../../data/trainingLoader.js';

export const prerender = true;

export async function getStaticPaths() {
  return trainingData.map(training => ({ 
    params: { 
      slug: training.slug 
    } 
  }));
}

const lang = 'en'; // English version without prefix
const trainingSlug = Astro.params.slug as string;

// Create training titles for sidebar
const trainingTitles = trainingData.reduce((acc, training) => {
  acc[training.slug] = training.title.en;
  return acc;
}, {} as Record<string, string>);

// Get current training for meta
const currentTraining = trainingData.find(t => t.slug === trainingSlug);
const trainingTitle = `${trainingTitles[trainingSlug] || 'Training'} - VyBrows Academy`;
const trainingDescription = currentTraining?.description?.en 
  ? `${currentTraining.description.en.substring(0, 155)}...` 
  : 'Professional permanent makeup training courses at VyBrows Academy. Expert-led PMU certification programs with hands-on practice and lifetime support.';
---

<NewsLayout title={trainingTitle} description={trainingDescription}>
  <BannerFix 
    title={trainingTitles[trainingSlug] || 'Training'} 
    subtitle="Professional Training Program"
    showBreadcrumb={true}
    breadcrumbItems={[
      { href: '/training', label: 'Training' },
      { href: `/training/${trainingSlug}`, label: trainingTitles[trainingSlug] || 'Course' }
    ]}
  />

  <div class="w-full bg-surface flex justify-center">
    <div class="w-full max-w-7xl bg-surface flex flex-col lg:flex-row gap-6 items-start px-6 py-8">
      <!-- Left Sidebar -->
      <aside class="w-full lg:w-64 bg-surface rounded-lg lg:mt-0 lg:sticky lg:top-32 z-20 order-1">
        <ul class="rounded-lg overflow-hidden flex flex-col">
          {trainingData.map((training, index) => (
            <li>
              <a 
                href={`/training/${training.slug}`} 
                class={`block rounded-none px-3 py-2 font-normal transition-colors flex items-center gap-2 ${training.slug === trainingSlug ? 'font-semibold' : 'hover:text-primary'}`}
                style={training.slug === trainingSlug ? 'color: var(--color-primary);' : 'color: rgba(0, 0, 0, 0.7);'}
              >
                <img src="/images/diamond.svg" alt="" class="w-8 h-8 flex-shrink-0" />
                <span>{training.title.en}</span>
              </a>
            </li>
          ))}
        </ul>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 space-y-12 order-2">
        {(() => {
          const currentTraining = trainingData.find(t => t.slug === trainingSlug) as any;
          return (
            <>
              <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-8">
                {/* Title */}
                <h1 class="text-3xl font-bold mb-2 text-on-surface">{trainingTitles[trainingSlug] ?? trainingSlug}</h1>
                
                {/* Subtitle */}
                {currentTraining?.subtitle && (
                  <p class="text-xl text-primary font-semibold mb-6">
                    {typeof currentTraining.subtitle === 'object' ? currentTraining.subtitle[lang] : currentTraining.subtitle}
                  </p>
                )}

                {/* Image */}
                {currentTraining?.image && (
                  <img
                    src={currentTraining.image}
                    alt={trainingTitles[trainingSlug] ?? trainingSlug}
                    class="w-full rounded-lg shadow-lg mb-6"
                  />
                )}

                {/* Introduction */}
                {currentTraining?.introduction && (
                  <p class="text-lg text-on-surface mb-6 leading-relaxed">
                    {typeof currentTraining.introduction === 'object' ? currentTraining.introduction[lang] : currentTraining.introduction}
                  </p>
                )}

                {/* Benefits */}
                {currentTraining?.benefits && (
                  <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-400 rounded-xl p-6 mb-8">
                    <h2 class="text-2xl font-bold text-green-800 mb-4">
                      ‚úì Key Benefits
                    </h2>
                    <ul class="space-y-3">
                      {(() => {
                        const benefitsData = typeof currentTraining.benefits === 'object' && !Array.isArray(currentTraining.benefits) 
                          ? currentTraining.benefits[lang] 
                          : currentTraining.benefits;
                        return (benefitsData || []).map((item: string) => (
                          <li class="flex items-start gap-3">
                            <span class="text-green-600 text-xl flex-shrink-0">‚úì</span>
                            <span class="text-gray-700">{item}</span>
                          </li>
                        ));
                      })()}
                    </ul>
                  </div>
                )}

                {/* Features/What You'll Learn */}
                {currentTraining?.features && (
                  <div class="bg-primary/5 border border-primary/20 rounded-xl p-6 mb-8">
                    <h2 class="text-2xl font-bold text-primary mb-4">
                      üìö What You'll Learn
                    </h2>
                    <ul class="space-y-3">
                      {(() => {
                        const featuresData = typeof currentTraining.features === 'object' && !Array.isArray(currentTraining.features) 
                          ? currentTraining.features[lang] 
                          : currentTraining.features;
                        return (featuresData || []).map((item: string) => (
                          <li class="flex items-start gap-3">
                            <span class="w-2 h-2 bg-primary rounded-full mt-2 flex-shrink-0"></span>
                            <span class="text-on-surface">{item}</span>
                          </li>
                        ));
                      })()}
                    </ul>
                  </div>
                )}

                {/* What's Included */}
                {currentTraining?.includes && (
                  <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-400 rounded-xl p-6 mb-8">
                    <h2 class="text-2xl font-bold text-blue-800 mb-4">
                      üéÅ What's Included
                    </h2>
                    <ul class="space-y-3">
                      {(() => {
                        const includesData = typeof currentTraining.includes === 'object' && !Array.isArray(currentTraining.includes) 
                          ? currentTraining.includes[lang] 
                          : currentTraining.includes;
                        return (includesData || []).map((item: string) => (
                          <li class="flex items-start gap-3">
                            <span class="text-blue-600 text-xl flex-shrink-0">‚úì</span>
                            <span class="text-gray-700">{item}</span>
                          </li>
                        ));
                      })()}
                    </ul>
                  </div>
                )}

                {/* Training Video */}
                {currentTraining?.videoUrl && currentTraining.videoUrl !== '' && (
                  <div class="mb-8">
                    <div class="flex justify-center">
                      <div class="relative w-full max-w-md aspect-[9/16]">
                        <iframe
                          src={`https://www.facebook.com/plugins/video.php?height=476&href=${encodeURIComponent(currentTraining.videoUrl)}&show_text=false&width=267&t=0`}
                          style="border:none;overflow:hidden;position:absolute;top:0;left:0;width:100%;height:100%;"
                          scrolling="no"
                          frameborder="0"
                          allowfullscreen="true"
                          allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"
                          class="rounded-lg shadow-lg"
                        ></iframe>
                      </div>
                    </div>
                  </div>
                )}

                {/* Contact Information */}
                <div class="rounded-xl p-6 mb-8" style="background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));">
                  <h2 class="text-2xl font-bold text-white mb-4">
                    üìû Get in Touch
                  </h2>
                  <div class="grid md:grid-cols-2 gap-4">
                    <a href="tel:+13464099999" class="flex items-start gap-3 text-white hover:text-white/90 transition-colors p-4 bg-white/10 backdrop-blur-sm rounded-lg border border-white/20">
                      <svg class="w-6 h-6 mt-0.5 flex-shrink-0 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M5.59347 10.624C7.51347 14.3973 10.6068 17.4773 14.3801 19.4106L17.3135 16.4773C17.6735 16.1173 18.2068 15.9973 18.6735 16.1573C20.1668 16.6506 21.7801 16.9173 23.4335 16.9173C24.1668 16.9173 24.7668 17.5173 24.7668 18.2506V22.904C24.7668 23.6373 24.1668 24.2373 23.4335 24.2373C10.9135 24.2373 0.7668 14.0906 0.7668 1.57064C0.7668 0.837305 1.3668 0.237305 2.10013 0.237305H6.7668C7.50013 0.237305 8.10013 0.837305 8.10013 1.57064C8.10013 3.2373 8.3668 4.83731 8.86013 6.33064C9.0068 6.79731 8.90013 7.31731 8.5268 7.69064L5.59347 10.624Z"/>
                      </svg>
                      <div>
                        <div class="font-semibold text-white">Phone</div>
                        <div class="text-sm text-white/90">(346) 409-9999</div>
                      </div>
                    </a>
                    
                    <a href="https://maps.app.goo.gl/tKoV1avuFa81XvfK7" target="_blank" rel="noopener noreferrer" class="flex items-start gap-3 text-white hover:text-white/90 transition-colors p-4 bg-white/10 backdrop-blur-sm rounded-lg border border-white/20">
                      <svg class="w-6 h-6 mt-0.5 flex-shrink-0 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                      </svg>
                      <div>
                        <div class="font-semibold text-white">Address</div>
                        <div class="text-sm text-white/90">13192 Bellaire Blvd #B<br/>Houston, TX 77072</div>
                      </div>
                    </a>
                  </div>

                  <div class="mt-6 pt-6 border-t border-white/20">
                    <div class="font-semibold text-white mb-3 text-center">Follow Us on Social Media</div>
                    <div class="flex justify-center gap-3">
                      <a href="https://www.facebook.com/vybrows" target="_blank" rel="noopener noreferrer" class="p-3 bg-white/20 backdrop-blur-sm text-white rounded-lg hover:bg-white/30 transition-colors border border-white/30" title="Facebook">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                      </a>
                      <a href="https://www.instagram.com/vybrowsbeauty" target="_blank" rel="noopener noreferrer" class="p-3 bg-white/20 backdrop-blur-sm text-white rounded-lg hover:bg-white/30 transition-colors border border-white/30" title="Instagram">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M12 0.237305C15.26 0.237305 15.6672 0.251974 16.9463 0.30957C18.2239 0.367974 19.0981 0.571987 19.8613 0.867188C20.6615 1.16867 21.3862 1.64092 21.9854 2.25098C22.5958 2.85044 23.0688 3.5762 23.3701 4.37695C23.6668 5.14001 23.8693 6.01279 23.9277 7.29004C23.9862 8.57004 24 8.9781 24 12.2373C24 15.4965 23.9862 15.9045 23.9277 17.1846C23.8693 18.4621 23.6662 19.3354 23.3701 20.0986C23.0687 20.8988 22.5964 21.6235 21.9863 22.2227C21.3864 22.8339 20.6611 23.3066 19.8613 23.6074C19.0981 23.9042 18.2248 24.1066 16.9473 24.165C15.6672 24.2235 15.2592 24.2373 12 24.2373C8.7408 24.2373 8.33274 24.2235 7.05273 24.165C5.77535 24.1066 4.90276 23.9034 4.13965 23.6074C3.3393 23.306 2.61395 22.8338 2.01465 22.2236C1.40359 21.6238 0.931674 20.8983 0.630859 20.0986C0.334066 19.3354 0.130672 18.4621 0.0722656 17.1846C0.0138616 15.9045 0 15.4973 0 12.2373C7.11643e-09 8.97739 0.0146694 8.57014 0.0722656 7.29102C0.130662 6.01358 0.334745 5.14008 0.629883 4.37695C0.931357 3.57659 1.40349 2.85124 2.01367 2.25195C2.61367 1.64074 3.33966 1.16897 4.13965 0.868164C4.90278 0.571424 5.77531 0.367972 7.05273 0.30957C8.33274 0.251166 8.7408 0.237305 12 0.237305ZM12 2.39941C8.796 2.39941 8.41598 2.41213 7.15039 2.46973C5.9812 2.52331 5.34605 2.71804 4.92285 2.88281C4.40159 3.07479 3.92915 3.38094 3.54199 3.7793C3.1228 4.1993 2.8623 4.60015 2.64551 5.16016C2.47995 5.58336 2.28601 6.2185 2.23242 7.3877C2.17482 8.65329 2.16211 9.0333 2.16211 12.2373C2.16211 15.4413 2.17482 15.8214 2.23242 17.0869C2.28601 18.2561 2.48074 18.8912 2.64551 19.3145C2.8376 19.8356 3.14374 20.3081 3.54199 20.6953C3.9292 21.0936 4.40162 21.3998 4.92285 21.5918C5.34605 21.7574 5.98121 21.9513 7.15039 22.0049C8.41598 22.0625 8.79519 22.0752 12 22.0752C15.2048 22.0752 15.5841 22.0625 16.8496 22.0049C18.0188 21.9513 18.6539 21.7566 19.0771 21.5918C19.5984 21.3999 20.0709 21.0937 20.458 20.6953C20.8563 20.3081 21.1625 19.8357 21.3545 19.3145C21.5201 18.8912 21.714 18.2561 21.7676 17.0869C21.8252 15.8214 21.8379 15.4413 21.8379 12.2373C21.8379 9.0333 21.8252 8.65329 21.7676 7.3877C21.714 6.21851 21.5193 5.58336 21.3545 5.16016C21.1378 4.60015 20.878 4.1993 20.458 3.7793C20.038 3.3601 19.6372 3.0996 19.0771 2.88281C18.6539 2.71725 18.0188 2.52332 16.8496 2.46973C15.5841 2.41213 15.204 2.39941 12 2.39941ZM12 6.06934C13.6358 6.06934 15.2046 6.71925 16.3613 7.87598C17.5181 9.0327 18.168 10.6015 18.168 12.2373C18.168 13.8731 17.5181 15.442 16.3613 16.5986C15.2046 17.7554 13.6358 18.4053 12 18.4053C10.3642 18.4053 8.79539 17.7554 7.63867 16.5986C6.48194 15.442 5.83203 13.8731 5.83203 12.2373C5.83203 10.6015 6.48195 9.0327 7.63867 7.87598C8.79539 6.71925 10.3642 6.06934 12 6.06934ZM12 8.2334C11.4742 8.2334 10.9536 8.33688 10.4678 8.53809C9.98201 8.73931 9.54074 9.03444 9.16895 9.40625C8.79714 9.77806 8.502 10.2193 8.30078 10.7051C8.09957 11.1908 7.99609 11.7115 7.99609 12.2373C7.99609 12.7631 8.09957 13.2838 8.30078 13.7695C8.50199 14.2553 8.79715 14.6965 9.16895 15.0684C9.54074 15.4401 9.98201 15.7353 10.4678 15.9365C10.9536 16.1378 11.4742 16.2412 12 16.2412C13.062 16.2412 14.0801 15.8192 14.8311 15.0684C15.5819 14.3174 16.0039 13.2992 16.0039 12.2373C16.0039 11.1754 15.5819 10.1572 14.8311 9.40625C14.0801 8.65536 13.062 8.2334 12 8.2334ZM18.5049 4.49902C18.8914 4.49913 19.2618 4.65343 19.5352 4.92676C19.8084 5.20012 19.9618 5.57048 19.9619 5.95703C19.9619 6.34371 19.8085 6.71485 19.5352 6.98828C19.2618 7.26154 18.8913 7.41493 18.5049 7.41504C18.1182 7.41504 17.7471 7.26165 17.4736 6.98828C17.2003 6.71485 17.0459 6.34371 17.0459 5.95703C17.046 5.5705 17.2004 5.20011 17.4736 4.92676C17.7471 4.65334 18.1181 4.49902 18.5049 4.49902Z"/>
                        </svg>
                      </a>
                    </div>
                  </div>
                </div>

                {/* Why Choose Us - Removed */}
              </div>
            </>
          );
        })()}
            </main>
    </div>
  </div>

  <!-- Simple Contact Form -->
  <section class="py-16" style="background-color: var(--color-primary);">
    <div class="max-w-3xl mx-auto px-4">
      <div class="text-center mb-8">
        <h2 class="text-3xl md:text-4xl font-bold mb-4" style="color: white;">
          Ready to Enroll?
        </h2>
        <p class="text-lg" style="color: rgba(255, 255, 255, 0.9);">
          Contact us today to reserve your spot in this training program
        </p>
      </div>

      <div class="bg-white rounded-2xl shadow-lg p-8">
        <form id="trainingContactForm" class="space-y-6">
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label for="name" class="block text-sm font-medium mb-2" style="color: #374151;">
                Name <span style="color: #ef4444;">*</span>
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full px-4 py-3 border rounded-lg transition-all"
                style="border-color: #d1d5db; outline: none;"
                placeholder="Your name"
                onfocus="this.style.borderColor='var(--color-primary)'; this.style.boxShadow='0 0 0 3px rgba(181, 140, 90, 0.1)';"
                onblur="this.style.borderColor='#d1d5db'; this.style.boxShadow='none';"
              />
            </div>

            <div>
              <label for="phone" class="block text-sm font-medium mb-2" style="color: #374151;">
                Phone <span style="color: #ef4444;">*</span>
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                required
                class="w-full px-4 py-3 border rounded-lg transition-all"
                style="border-color: #d1d5db; outline: none;"
                placeholder="Your phone number"
                onfocus="this.style.borderColor='var(--color-primary)'; this.style.boxShadow='0 0 0 3px rgba(181, 140, 90, 0.1)';"
                onblur="this.style.borderColor='#d1d5db'; this.style.boxShadow='none';"
              />
            </div>
          </div>

          <div>
            <label for="email" class="block text-sm font-medium mb-2" style="color: #374151;">
              Email
            </label>
            <input
              type="email"
              id="email"
              name="email"
              class="w-full px-4 py-3 border rounded-lg transition-all"
              style="border-color: #d1d5db; outline: none;"
              placeholder="your@email.com (optional)"
              onfocus="this.style.borderColor='var(--color-primary)'; this.style.boxShadow='0 0 0 3px rgba(181, 140, 90, 0.1)';"
              onblur="this.style.borderColor='#d1d5db'; this.style.boxShadow='none';"
            />
          </div>

          <div>
            <label for="message" class="block text-sm font-medium mb-2" style="color: #374151;">
              Message
            </label>
            <textarea
              id="message"
              name="message"
              rows="4"
              class="w-full px-4 py-3 border rounded-lg transition-all resize-none"
              style="border-color: #d1d5db; outline: none;"
              placeholder="Tell us about your interest in this training..."
              onfocus="this.style.borderColor='var(--color-primary)'; this.style.boxShadow='0 0 0 3px rgba(181, 140, 90, 0.1)';"
              onblur="this.style.borderColor='#d1d5db'; this.style.boxShadow='none';"
            ></textarea>
          </div>

          <div class="text-center">
            <button
              type="submit"
              class="px-8 py-4 font-bold text-lg rounded-lg shadow-lg transition-all transform"
              style="background-color: var(--color-primary); color: white;"
              onmouseover="this.style.backgroundColor='var(--color-primary-hover)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)';"
              onmouseout="this.style.backgroundColor='var(--color-primary)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)';"
            >
              Send Inquiry
            </button>
          </div>

          <div id="formMessage" class="hidden text-center p-4 rounded-lg"></div>
        </form>
      </div>
    </div>
  </section>

  <script>
    document.getElementById('trainingContactForm')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const form = e.target as HTMLFormElement;
      const formData = new FormData(form);
      const messageDiv = document.getElementById('formMessage');
      
      if (!messageDiv) return;
      
      try {
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name: formData.get('name'),
            phone: formData.get('phone'),
            email: formData.get('email'),
            subject: 'Training Inquiry',
            message: formData.get('message'),
          }),
        });

        if (response.ok) {
          messageDiv.textContent = 'Thank you! We will contact you soon.';
          messageDiv.className = 'text-center p-4 rounded-lg bg-green-100 text-green-800';
          messageDiv.classList.remove('hidden');
          form.reset();
          
          setTimeout(() => {
            messageDiv.classList.add('hidden');
          }, 5000);
        } else {
          throw new Error('Failed to send message');
        }
      } catch (error) {
        messageDiv.textContent = 'Sorry, something went wrong. Please try again or call us directly.';
        messageDiv.className = 'text-center p-4 rounded-lg bg-red-100 text-red-800';
        messageDiv.classList.remove('hidden');
      }
    });
  </script>
</NewsLayout>
```