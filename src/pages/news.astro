---
import '/src/styles/global.css';
import NewsLayout from '../layouts/NewsLayout.astro';
import NewsListComp from '../components/UI/layout/NewsListComp.astro';
import BannerFix from '../components/UI/section/BannerFix.astro';
import { getAllNews } from '../data/newsLoader.js';

export const prerender = true;

const lang = 'en'; // English version without prefix
const PAGE_SIZE = 25;
const pageParam = Astro.url?.searchParams.get('page');
const currentPage = pageParam ? parseInt(pageParam) : 1;

// Get news from JSON data for English
const allNews = getAllNews();
console.log('Total news articles:', allNews.length);
const news = allNews.map((item) => {
  const translation = item.translations.en; // Always English for this route
  return {
    id: item.id,
    title: translation.title,
    description: translation.shortDescription,
    image: item.mainImage,
    date: item.createdDate,
    category: 'PMU News', // Default category
    link: `/news/${item.slug || item.id}`, // No /en/ prefix
  };
})
// Sort by date descending (newest first)
.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

const totalNews = news.length;
const totalPages = Math.ceil(totalNews / PAGE_SIZE);
const pagedNews = news.slice((currentPage - 1) * PAGE_SIZE, currentPage * PAGE_SIZE);
---

<NewsLayout title="News & Updates">
  <BannerFix 
    title="News & Updates" 
    subtitle="Stay updated with the latest news, trends, and insights from VyBrows Academy"
    showBreadcrumb={true}
    breadcrumbItems={[{ href: '/news', label: 'News' }]}
  />

  <!-- Main Content -->
  <section class="py-16 px-6 min-h-screen" style="background: var(--color-bg);">
    <div class="max-w-7xl mx-auto">

      <!-- News Content -->
      <div id="newsContainer">
        <NewsListComp news={pagedNews} viewMode="grid" />
      </div>

      <!-- Pagination -->
      {totalPages > 1 && (
        <div class="flex justify-center items-center mt-12 gap-2">
          <!-- Previous Button -->
          {currentPage > 1 && (
            <a 
              href={`/news?page=${currentPage - 1}`}
              class="flex items-center gap-1 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
              Previous
            </a>
          )}

          <!-- Page 1 -->
          <a 
            href="/news?page=1"
            class={currentPage === 1 
              ? 'px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-primary text-white' 
              : 'px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-white border border-gray-300 hover:bg-gray-50 text-gray-700'
            }
          >1</a>

          {totalPages > 1 && (
            <a 
              href="/news?page=2"
              class={currentPage === 2 
                ? 'px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-primary text-white' 
                : 'px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-white border border-gray-300 hover:bg-gray-50 text-gray-700'
              }
            >2</a>
          )}

          {totalPages > 2 && (
            <a 
              href="/news?page=3"
              class={currentPage === 3 
                ? 'px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-primary text-white' 
                : 'px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-white border border-gray-300 hover:bg-gray-50 text-gray-700'
              }
            >3</a>
          )}

          {totalPages > 4 && currentPage > 3 && <span class="px-2 text-gray-500">...</span>}

          {totalPages > 3 && currentPage > 3 && currentPage < totalPages && (
            <a 
              href={`/news?page=${currentPage}`}
              class="px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-primary text-white"
            >{currentPage}</a>
          )}

          {totalPages > 4 && currentPage < totalPages - 2 && <span class="px-2 text-gray-500">...</span>}

          {totalPages > 3 && (
            <a 
              href={`/news?page=${totalPages}`}
              class={currentPage === totalPages 
                ? 'px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-primary text-white' 
                : 'px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-white border border-gray-300 hover:bg-gray-50 text-gray-700'
              }
            >{totalPages}</a>
          )}

          <!-- Next Button -->
          {currentPage < totalPages && (
            <a 
              href={`/news?page=${currentPage + 1}`}
              class="flex items-center gap-1 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium"
            >
              Next
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          )}
        </div>
      )}
    </div>
  </section>
</NewsLayout>