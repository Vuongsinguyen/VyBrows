---
import Dropdown from '../layout/Dropdown.astro';
import { menus } from '../../../content/menu.ts';
import type { MenuItem } from '../../../content/menu.ts';
import MobileDropdown from '../layout/MobileDropdown.astro';

export interface Props {
  class?: string;
}

const { class: customClass = '' } = Astro.props;

// Detect current language from URL
const currentLang = Astro.url.pathname.split('/')[1] || 'en';
const menuItems: MenuItem[] = menus[currentLang] || menus['en'];

// Language mapping for TopBar
const langMap = {
  'vi': 'Tiáº¿ng Viá»‡t',
  'en': 'English', 
  'ja': 'æ—¥æœ¬èªž'
};

const currentLangDisplay = langMap[currentLang as keyof typeof langMap] || langMap['en'];

// Multi-language content
const translations = {
  en: {
    home: "Home",
    about: "About",
    services: "Services", 
    products: "Products",
    news: "News",
    contact: "Contact",
    aboutItems: [
      { href: currentLang === 'en' ? '/about-us' : `/${currentLang}/about-us`, title: "About Us", description: "Learn about ARIS Vietnam" },
      { href: currentLang === 'en' ? '/history' : `/${currentLang}/history`, title: "Our History", description: "Our development journey" },
      { href: currentLang === 'en' ? '/team' : `/${currentLang}/team`, title: "Our Team", description: "Talented people" },
      { href: currentLang === 'en' ? '/vision' : `/${currentLang}/vision`, title: "Vision & Mission", description: "Future orientation" }
    ],
    serviceItems: [
      { href: currentLang === 'en' ? '/web-development' : `/${currentLang}/web-development`, title: "Web Development", description: "Modern and responsive websites" },
      { href: currentLang === 'en' ? '/mobile-app' : `/${currentLang}/mobile-app`, title: "Mobile Apps", description: "Professional iOS and Android apps" },
      { href: currentLang === 'en' ? '/design' : `/${currentLang}/design`, title: "UI/UX Design", description: "Beautiful and user-friendly interfaces" },
      { href: currentLang === 'en' ? '/consulting' : `/${currentLang}/consulting`, title: "IT Consulting", description: "Comprehensive technology solutions" }
    ],
    productItems: [
      { href: currentLang === 'en' ? '/erp-system' : `/${currentLang}/erp-system`, title: "ERP System", description: "Comprehensive business management" },
      { href: currentLang === 'en' ? '/crm-solution' : `/${currentLang}/crm-solution`, title: "CRM Solution", description: "Effective customer management" },
      { href: currentLang === 'en' ? '/ecommerce' : `/${currentLang}/ecommerce`, title: "E-commerce", description: "Online sales platform" },
      { href: currentLang === 'en' ? '/pos-system' : `/${currentLang}/pos-system`, title: "POS System", description: "Point of sale and sales management" }
    ],
    newsItems: [
      { href: currentLang === 'en' ? '/news' : `/${currentLang}/news`, title: "Company News", description: "Latest updates from ARIS" },
      { href: currentLang === 'en' ? '/blog' : `/${currentLang}/blog`, title: "Tech Blog", description: "IT knowledge and trends" },
      { href: currentLang === 'en' ? '/events' : `/${currentLang}/events`, title: "Events", description: "Activities and workshops" },
      { href: currentLang === 'en' ? '/press' : `/${currentLang}/press`, title: "Press Coverage", description: "News about ARIS Vietnam" }
    ],
    contactItems: [
      { href: currentLang === 'en' ? '/contact' : `/${currentLang}/contact`, title: "Contact Info", description: "Address, phone and email" },
      { href: currentLang === 'en' ? '/quote' : `/${currentLang}/quote`, title: "Request Quote", description: "Send your project request" },
      { href: currentLang === 'en' ? '/support' : `/${currentLang}/support`, title: "Technical Support", description: "24/7 help and consultation" },
      { href: currentLang === 'en' ? '/career' : `/${currentLang}/career`, title: "Careers", description: "Career opportunities at ARIS" }
    ]
  },
  vi: {
    home: "Trang chá»§",
    about: "Giá»›i thiá»‡u",
    services: "Dá»‹ch vá»¥",
    products: "Sáº£n pháº©m", 
    news: "Tin tá»©c",
    contact: "LiÃªn há»‡",
    aboutItems: [
      { href: `/${currentLang}/about-us`, title: "Vá» chÃºng tÃ´i", description: "TÃ¬m hiá»ƒu vá» ARIS Vietnam" },
      { href: `/${currentLang}/history`, title: "Lá»‹ch sá»­ phÃ¡t triá»ƒn", description: "Cháº·ng Ä‘Æ°á»ng phÃ¡t triá»ƒn cá»§a chÃºng tÃ´i" },
      { href: `/${currentLang}/team`, title: "Äá»™i ngÅ©", description: "Nhá»¯ng con ngÆ°á»i tÃ i nÄƒng" },
      { href: `/${currentLang}/vision`, title: "Táº§m nhÃ¬n sá»© má»‡nh", description: "Äá»‹nh hÆ°á»›ng tÆ°Æ¡ng lai" }
    ],
    serviceItems: [
      { href: `/${currentLang}/web-development`, title: "PhÃ¡t triá»ƒn Web", description: "Trang web hiá»‡n Ä‘áº¡i vÃ  responsive" },
      { href: `/${currentLang}/mobile-app`, title: "á»¨ng dá»¥ng Mobile", description: "App iOS vÃ  Android chuyÃªn nghiá»‡p" },
      { href: `/${currentLang}/design`, title: "Thiáº¿t káº¿ UI/UX", description: "Giao diá»‡n Ä‘áº¹p vÃ  dá»… sá»­ dá»¥ng" },
      { href: `/${currentLang}/consulting`, title: "TÆ° váº¥n IT", description: "Giáº£i phÃ¡p cÃ´ng nghá»‡ toÃ n diá»‡n" }
    ],
    productItems: [
      { href: `/${currentLang}/erp-system`, title: "Há»‡ thá»‘ng ERP", description: "Quáº£n lÃ½ doanh nghiá»‡p toÃ n diá»‡n" },
      { href: `/${currentLang}/crm-solution`, title: "Giáº£i phÃ¡p CRM", description: "Quáº£n lÃ½ khÃ¡ch hÃ ng hiá»‡u quáº£" },
      { href: `/${currentLang}/ecommerce`, title: "E-commerce", description: "Ná»n táº£ng bÃ¡n hÃ ng trá»±c tuyáº¿n" },
      { href: `/${currentLang}/pos-system`, title: "Há»‡ thá»‘ng POS", description: "Thanh toÃ¡n vÃ  quáº£n lÃ½ bÃ¡n hÃ ng" }
    ],
    newsItems: [
      { href: `/${currentLang}/news`, title: "Tin cÃ´ng ty", description: "Cáº­p nháº­t má»›i nháº¥t tá»« ARIS" },
      { href: `/${currentLang}/blog`, title: "Blog cÃ´ng nghá»‡", description: "Kiáº¿n thá»©c vÃ  xu hÆ°á»›ng IT" },
      { href: `/${currentLang}/events`, title: "Sá»± kiá»‡n", description: "CÃ¡c hoáº¡t Ä‘á»™ng vÃ  workshop" },
      { href: `/${currentLang}/press`, title: "BÃ¡o chÃ­ nÃ³i vá»", description: "ÄÆ°a tin vá» ARIS Vietnam" }
    ],
    contactItems: [
      { href: `/${currentLang}/contact`, title: "ThÃ´ng tin liÃªn há»‡", description: "Äá»‹a chá»‰, Ä‘iá»‡n thoáº¡i vÃ  email" },
      { href: `/${currentLang}/quote`, title: "YÃªu cáº§u bÃ¡o giÃ¡", description: "Gá»­i yÃªu cáº§u dá»± Ã¡n cá»§a báº¡n" },
      { href: `/${currentLang}/support`, title: "Há»— trá»£ ká»¹ thuáº­t", description: "Trá»£ giÃºp vÃ  tÆ° váº¥n 24/7" },
      { href: `/${currentLang}/career`, title: "Tuyá»ƒn dá»¥ng", description: "CÆ¡ há»™i nghá» nghiá»‡p táº¡i ARIS" }
    ]
  },
  ja: {
    home: "ãƒ›ãƒ¼ãƒ ",
    about: "ä¼šç¤¾ç´¹ä»‹",
    services: "ã‚µãƒ¼ãƒ“ã‚¹",
    products: "è£½å“",
    news: "ãƒ‹ãƒ¥ãƒ¼ã‚¹", 
    contact: "ãŠå•ã„åˆã‚ã›",
    aboutItems: [
      { href: `/${currentLang}/about-us`, title: "ä¼šç¤¾æ¦‚è¦", description: "ARIS Vietnamã«ã¤ã„ã¦" },
      { href: `/${currentLang}/history`, title: "æ²¿é©", description: "ç§ãŸã¡ã®ç™ºå±•ã®æ­©ã¿" },
      { href: `/${currentLang}/team`, title: "ãƒãƒ¼ãƒ ", description: "æ‰èƒ½ã‚ã‚‹äººæ" },
      { href: `/${currentLang}/vision`, title: "ãƒ“ã‚¸ãƒ§ãƒ³ãƒ»ãƒŸãƒƒã‚·ãƒ§ãƒ³", description: "å°†æ¥ã®æ–¹å‘æ€§" }
    ],
    serviceItems: [
      { href: `/${currentLang}/web-development`, title: "Webã‚µã‚¤ãƒˆé–‹ç™º", description: "ãƒ¢ãƒ€ãƒ³ã§ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ" },
      { href: `/${currentLang}/mobile-app`, title: "ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª", description: "ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªiOSãƒ»Androidã‚¢ãƒ—ãƒª" },
      { href: `/${currentLang}/design`, title: "UI/UXãƒ‡ã‚¶ã‚¤ãƒ³", description: "ç¾Žã—ãä½¿ã„ã‚„ã™ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹" },
      { href: `/${currentLang}/consulting`, title: "ITã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°", description: "åŒ…æ‹¬çš„ãªæŠ€è¡“ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³" }
    ],
    productItems: [
      { href: `/${currentLang}/erp-system`, title: "ERPã‚·ã‚¹ãƒ†ãƒ ", description: "åŒ…æ‹¬çš„ãªæ¥­å‹™ç®¡ç†" },
      { href: `/${currentLang}/crm-solution`, title: "CRMã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³", description: "åŠ¹æžœçš„ãªé¡§å®¢ç®¡ç†" },
      { href: `/${currentLang}/ecommerce`, title: "Eã‚³ãƒžãƒ¼ã‚¹", description: "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è²©å£²ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ " },
      { href: `/${currentLang}/pos-system`, title: "POSã‚·ã‚¹ãƒ†ãƒ ", description: "è²©å£²æ™‚ç‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ " }
    ],
    newsItems: [
      { href: `/${currentLang}/news`, title: "ä¼šç¤¾ãƒ‹ãƒ¥ãƒ¼ã‚¹", description: "ARISã‹ã‚‰ã®æœ€æ–°æƒ…å ±" },
      { href: `/${currentLang}/blog`, title: "æŠ€è¡“ãƒ–ãƒ­ã‚°", description: "ITçŸ¥è­˜ã¨ãƒˆãƒ¬ãƒ³ãƒ‰" },
      { href: `/${currentLang}/events`, title: "ã‚¤ãƒ™ãƒ³ãƒˆ", description: "æ´»å‹•ã¨ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—" },
      { href: `/${currentLang}/press`, title: "ãƒ—ãƒ¬ã‚¹", description: "ARIS Vietnamã«é–¢ã™ã‚‹å ±é“" }
    ],
    contactItems: [
      { href: `/${currentLang}/contact`, title: "é€£çµ¡å…ˆ", description: "ä½æ‰€ã€é›»è©±ã€ãƒ¡ãƒ¼ãƒ«" },
      { href: `/${currentLang}/quote`, title: "ãŠè¦‹ç©ã‚Šä¾é ¼", description: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã”ä¾é ¼" },
      { href: `/${currentLang}/support`, title: "æŠ€è¡“ã‚µãƒãƒ¼ãƒˆ", description: "24æ™‚é–“ã‚µãƒãƒ¼ãƒˆã¨ã‚³ãƒ³ã‚µãƒ«ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³" },
      { href: `/${currentLang}/career`, title: "æŽ¡ç”¨æƒ…å ±", description: "ARISã§ã®ã‚­ãƒ£ãƒªã‚¢æ©Ÿä¼š" }
    ]
  }
};

// Get current language content with fallback to English
const t = translations[currentLang as keyof typeof translations] || translations.en;

// Mobile dropdown items (simplified)
const aboutMobileItems = t.aboutItems.map(item => ({ href: item.href, title: item.title }));
const serviceMobileItems = t.serviceItems.map(item => ({ href: item.href, title: item.title }));
const productMobileItems = t.productItems.map(item => ({ href: item.href, title: item.title }));
const newsMobileItems = t.newsItems.map(item => ({ href: item.href, title: item.title }));
const contactMobileItems = t.contactItems.map(item => ({ href: item.href, title: item.title }));
---

<!-- TopBar Section -->
<div id="topbar" class="text-white w-full" style="background: var(--topbar-bg);">
  <div class="max-w-[1280px] mx-auto flex justify-between items-center px-6 py-0.1 text-sm font-medium transition-colors">
    <!-- Contact Info -->
    <div class="flex items-center space-x-6">
      <!-- Desktop: show email and phone text, JP phone only on md+ -->
      <span class="items-center gap-1 hidden md:flex" style="color: var(--color-text);">
        <span class="material-icons-outlined text-base" style="font-size: 20px; color: var(--color-text);">mail</span>
        contact@aris-vn.com
      </span>
      <span class="items-center gap-1 hidden md:flex" style="color: var(--color-text);">
        <span class="material-icons-outlined text-base" style="font-size: 20px; color: var(--color-text);">call</span>
        VN: (+83) 28 3842-4483
      </span>
      <span class="items-center gap-1 hidden md:flex" style="color: var(--color-text);">
        <span class="material-icons-outlined text-base" style="font-size: 20px; color: var(--color-text);">call</span>
        JP: (+81) 3 3340-1053
      </span>
      <!-- Mobile: only show icons -->
      <a href="/${currentLang}/contact" class="md:hidden flex items-center" aria-label="Gá»­i email">
        <span class="material-icons-outlined text-white text-base" style="font-size: 20px;">mail</span>
      </a>
      <a href="tel:+832838424483" class="md:hidden flex items-center" aria-label="Gá»i Ä‘iá»‡n thoáº¡i">
        <span class="material-icons-outlined text-white text-base" style="font-size: 20px;">call</span>
      </a>
    </div>
    <!-- Controls -->
    <div class="flex items-center gap-4">
      <!-- Language Dropdown -->
      <div class="relative" role="menu" aria-label="Language Switcher">
        <button id="lang-dropdown-btn" class="transition flex items-center gap-1" aria-haspopup="true" aria-expanded="false" type="button" style="color: var(--color-text);">
          {currentLangDisplay}
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: var(--color-text);">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div id="lang-dropdown-menu" class="absolute right-0 top-full pt-2 hidden z-[99999]">
          <div class="bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 min-w-[140px]">
            <a role="menuitem" href="#" class={`block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 first:rounded-t-md lang-switch ${currentLang === 'vi' ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400' : 'text-gray-700 dark:text-gray-200'}`} data-lang="vi">ðŸ‡»ðŸ‡³ Tiáº¿ng Viá»‡t</a>
            <a role="menuitem" href="/" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 lang-switch bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400" data-lang="en">ðŸ‡ºðŸ‡¸ English</a>
            <a role="menuitem" href="#" class={`block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 last:rounded-b-md lang-switch ${currentLang === 'ja' ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400' : 'text-gray-700 dark:text-gray-200'}`} data-lang="ja">ðŸ‡¯ðŸ‡µ æ—¥æœ¬èªž</a>
</style>
<script is:inline>
// Language dropdown: always keep current path, only change lang prefix
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.lang-switch').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const lang = this.getAttribute('data-lang');
      if (lang === 'en') {
        window.location.pathname = '/';
      } else if (lang) {
        const path = window.location.pathname.replace(/^\/(en|vi|ja)(\/)?/, '');
        window.location.pathname = `/${lang}/${path}`.replace(/\/+/g, '/');
      }
    });
  });
});
</script>
          </div>
        </div>
      </div>
      <!-- Dark Mode Toggle -->
      <button id="toggle-dark" style="background-color: transparent;" class="px-4 py-2 rounded cursor-pointer hover:bg-white/10 dark:hover:bg-gray-800/30 transition-all flex items-center gap-2" aria-label="Toggle dark mode">
        <!-- Sun icon for light mode -->
        <svg id="sun-icon" class="w-5 h-5" fill="var(--color-white2white)" viewBox="0 0 24 24">
          <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" style="fill:var(--color-white2white)!important;" />
        </svg>
        <!-- Moon icon for dark mode (balanced crescent) -->
        <svg id="moon-icon" class="w-5 h-5 hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14.5 2C16.32 2 18.03 2.5 19.5 3.35C16.51 5.08 14.5 8.3 14.5 12C14.5 15.7 16.51 18.92 19.5 20.65C18.03 21.5 16.32 22 14.5 22C8.98 22 4.5 17.52 4.5 12C4.5 6.48 8.98 2 14.5 2Z" fill="var(--color-black2white)"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Navbar Section -->

<nav
  id="main-navbar"
  class={`bg-surface backdrop-blur-md transition-colors duration-200 ${customClass}`}

>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-14">
      <!-- Logo/Brand -->
      <div class="flex-shrink-0">
        <a href={currentLang === 'en' ? '/' : `/${currentLang}`} class="flex items-center">
          <img src="/logo-aris.svg" alt="ARIS VIETNAM" class="h-8 w-auto" style="color: var(--color-blue2white);" />
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:block">
        <div class="ml-10 flex items-center space-x-1">
          {menuItems.map((item: MenuItem) =>
            item.children && item.children.length > 0 ? (
              <Dropdown label={item.label} items={item.children} />
            ) : (
              item.label === t.home ? (
                <a href={currentLang === 'en' ? '/' : `/${currentLang}`} class="text-gray-900 dark:text-gray-100 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center font-playfair">
                  <span class="whitespace-nowrap" style="color: var(--color-black2white);">{item.label}</span>
                </a>
              ) : (
                <a href={item.href} class="text-gray-900 dark:text-gray-100 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center font-playfair">
                  <span class="whitespace-nowrap" style="color: var(--color-black2white);">{item.label}</span>
                </a>
              )
            )
          )}
        </div>
      </div>

            <!-- Mobile Menu Button -->
      <div class="md:hidden">
        <button 
          class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 dark:text-gray-300 hover:text-gray-500 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 dark:focus:ring-blue-400 transition-colors"
          id="mobile-menu-button"
        >
          <svg class="h-6 w-6 block" fill="none" viewBox="0 0 24 24" stroke="currentColor" id="menu-icon">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" id="close-icon">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Navigation (hidden by default) -->
  <div class="md:hidden hidden" id="mobile-menu">
    <div class="px-4 pt-2 pb-3 space-y-2 bg-gray-50/95 dark:bg-gray-900/95 backdrop-blur-md border-t border-gray-200/50 dark:border-gray-600/50">
      <a href={currentLang === 'en' ? '/' : `/${currentLang}`} class="text-gray-900 dark:text-gray-100 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-800 block px-3 py-2 rounded-md text-base font-medium transition-colors font-playfair">
        {t.home}
      </a>
      
      <!-- Mobile Dropdown Components -->
      <MobileDropdown label={t.about} items={aboutMobileItems} />
      <MobileDropdown label={t.services} items={serviceMobileItems} />
      <MobileDropdown label={t.products} items={productMobileItems} />
      <MobileDropdown label={t.news} items={newsMobileItems} />
      <MobileDropdown label={t.contact} items={contactMobileItems} />
    </div>
  </div>
</nav>

<!-- Material Icons CDN -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

<script>
  // Apply theme immediately to prevent flash
  (function() {
    if (typeof window !== 'undefined') {
      const theme = localStorage.getItem("theme");
      if (theme === "dark" || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add("dark");
      }
    }
  })();

  document.addEventListener('DOMContentLoaded', function() {
    // Language dropdown toggle for mobile
    const langBtn = document.getElementById('lang-dropdown-btn');
    const langMenu = document.getElementById('lang-dropdown-menu');
    if (langBtn && langMenu) {
      langBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        langMenu.classList.toggle('hidden');
      });
      // Hide dropdown when clicking outside
      document.addEventListener('click', function(e) {
        const target = e.target as Node;
        if (!langBtn.contains(target) && !langMenu.contains(target)) {
          langMenu.classList.add('hidden');
        }
      });
    }
    const menuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    const topbar = document.getElementById('topbar');
    const navbar = document.getElementById('main-navbar');
    
    // Mobile menu toggle
    if (menuButton && mobileMenu && menuIcon && closeIcon) {
      menuButton.addEventListener('click', function() {
        // Toggle menu visibility
        mobileMenu.classList.toggle('hidden');
        
        // Toggle icons
        menuIcon.classList.toggle('hidden');
        menuIcon.classList.toggle('block');
        closeIcon.classList.toggle('hidden');
        closeIcon.classList.toggle('block');
      });
    }

    // Dark mode functionality
    const toggleBtn = document.getElementById("toggle-dark");
    const sunIcon = document.getElementById("sun-icon");
    const moonIcon = document.getElementById("moon-icon");

    // Function to update icons based on theme
    function updateIcons(isDark: boolean) {
      if (isDark) {
        sunIcon?.classList.add('hidden');
        moonIcon?.classList.remove('hidden');
      } else {
        sunIcon?.classList.remove('hidden');
        moonIcon?.classList.add('hidden');
      }
    }

    // Function to toggle theme
    function toggleTheme() {
      console.log('Toggle theme clicked'); // Debug log
      const html = document.documentElement;
      const isDark = html.classList.contains("dark");
      console.log('Current is dark:', isDark); // Debug log

      if (isDark) {
        html.classList.remove("dark");
        localStorage.setItem("theme", "light");
        updateIcons(false);
        console.log('Switched to light mode'); // Debug log
      } else {
        html.classList.add("dark");
        localStorage.setItem("theme", "dark");
        updateIcons(true);
        console.log('Switched to dark mode'); // Debug log
      }
    }

    // Initialize theme and icons
    const theme = localStorage.getItem("theme");
    let isDarkMode;
    
    if (theme === "dark") {
      document.documentElement.classList.add("dark");
      isDarkMode = true;
    } else if (theme === "light") {
      document.documentElement.classList.remove("dark");
      isDarkMode = false;
    } else {
      // Default to system preference
      isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (isDarkMode) {
        document.documentElement.classList.add("dark");
      }
    }
    
    updateIcons(isDarkMode);

    // Add click event listener
    toggleBtn?.addEventListener("click", toggleTheme);
  });
</script>

<script is:inline>
document.getElementById('theme-toggle-btn')?.addEventListener('click', () => {
  const html = document.documentElement;
  html.dataset.theme = html.dataset.theme === 'dark' ? 'light' : 'dark';
});
</script>

<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-navbar-bg: rgba(31,41,55,0.8);
    --color-navbar-border: rgba(55,65,81,0.3);
  }
}
</style>
