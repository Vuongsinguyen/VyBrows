---
import Button from '../shared/Button.astro';

export interface Slide {
  title: string;
  subtitle: string;
  description: string;
  primaryButton: string;
  secondaryButton: string;
  backgroundGradient: string;
}

export interface Props {
  slides: Slide[];
  autoSlideInterval?: number;
  class?: string;
}

// doubled the default slide display time from 6000ms to 12000ms
const { slides, autoSlideInterval = 12000, class: customClass = '' } = Astro.props;
---

<section class={`relative overflow-hidden z-0 h-[70vh] min-h-[680px] max-h-[60vh] pb-[50px] ${customClass}`}> 
  
  <!-- Canvas cho fireflies -->
  <canvas class="fireflies absolute top-0 left-0 w-full h-full z-[2] pointer-events-none"></canvas>

  <div class="slider-container relative h-[70vh] min-h-[680px] max-h-[60vh] pb-[50px] z-[1]" style="background: var(--slider-bg);">
    {slides.map((slide, index) => (
      <div class={`slide ${index === 0 ? 'active' : ''} flex items-center justify-center`}>
        <div
          class="w-full max-w-[1080px] md:max-w-[1180px] h-[90%] rounded-[2rem] border
                 mt-[100px] md:mt-[310px]
                 pb-[30px] mb-[80px] mx-[25px] md:mx-[20px] overflow-hidden relative"
          style="border-color: #e7d48e; box-shadow: 0 8px 32px 0 rgba(0,0,0,0.18); background: transparent;"
        >
          <!-- Static slide image -->
          <img
            src={`/images/Slide/slide${(index+1).toString().padStart(2, '0')}.avif`}
            alt={`slide${(index+1).toString().padStart(2, '0')}`}
            class="w-full h-full object-cover rounded-[2rem]"
          />
        </div>
      </div>
    ))}

    <!-- Navigation -->
    <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex space-x-2">
      {slides.map((_, index) => (
        <button 
          class={`dot w-3 h-3 rounded-full transition-all duration-300${index === 0 ? ' active' : ''}`}
          data-slide={index}
        ></button>
      ))}
    </div>

    <!-- Arrows -->
    <button class="prev-btn absolute left-4 top-1/2 transform -translate-y-1/2 p-2 rounded-full transition-all" style="background-color: var(--slider-arrow-bg);">
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="rgba(231, 212, 142, 0.3)">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
    <button class="next-btn absolute right-4 top-1/2 transform -translate-y-1/2 p-2 rounded-full transition-all" style="background-color: var(--slider-arrow-bg);">
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="rgba(231, 212, 142, 0.3)">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>
  </div>
</section>

<style>
  .slider-container {
    position: relative;
    overflow: hidden;
    z-index: 1;
    background: #003324 !important;
  }
  .slide {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    opacity: 0; transition: opacity 0.5s ease-in-out;
    background: transparent !important;
  }
  .slide.active { opacity: 1; }
  .dot { background-color: rgba(231, 212, 142, 0.3); }
  .dot.active { background-color: var(--color-blueWhite); }
  .fireflies { z-index: 2; }
</style>

<script define:vars={{ autoSlideInterval }}>
  document.addEventListener('DOMContentLoaded', function() {
    // Slider logic
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.dot');
    const nextBtn = document.querySelector('.next-btn');
    const prevBtn = document.querySelector('.prev-btn');
    let currentSlide = 0;
    let autoSlideIntervalId;

    function showSlide(index) {
      slides.forEach(slide => slide.classList.remove('active'));
      dots.forEach(dot => dot.classList.remove('active'));
      if (slides[index]) slides[index].classList.add('active');
      if (dots[index]) dots[index].classList.add('active');
      currentSlide = index;
    }
    function nextSlide() { showSlide((currentSlide + 1) % slides.length); }
    function prevSlide() { showSlide((currentSlide - 1 + slides.length) % slides.length); }
    function startAutoSlide() {
      autoSlideIntervalId = setInterval(nextSlide, autoSlideInterval);
    }
    function stopAutoSlide() { clearInterval(autoSlideIntervalId); autoSlideIntervalId = null; }

    nextBtn?.addEventListener('click', () => { stopAutoSlide(); nextSlide(); startAutoSlide(); });
    prevBtn?.addEventListener('click', () => { stopAutoSlide(); prevSlide(); startAutoSlide(); });
    dots.forEach((dot, index) => dot.addEventListener('click', () => { stopAutoSlide(); showSlide(index); startAutoSlide(); }));

    const sliderContainer = document.querySelector('.slider-container');
    sliderContainer?.addEventListener('mouseenter', stopAutoSlide);
    sliderContainer?.addEventListener('mouseleave', startAutoSlide);
    startAutoSlide();

    // Fireflies (particles)
    const canvas = document.querySelector('.fireflies');
    const ctx = canvas.getContext('2d');
    let w, h;
    const fireflies = [];

    function resize() {
      w = canvas.width = canvas.offsetWidth;
      h = canvas.height = canvas.offsetHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const count = 50;
    for (let i = 0; i < count; i++) {
      const f = document.createElement('div');
      // random top between 60% and 100% of height
      const topPercent = Math.random() * 40 + 60;
      fireflies.push({
        x: Math.random() * w,
        y: (topPercent / 100) * h,
        r: Math.random() * 2 + 1.5,
        dx: (Math.random() - 0.5) * 0.5,
        dy: (Math.random() - 0.5) * 0.5,
        alpha: Math.random(),
        da: Math.random() * 0.02 + 0.01
      });
    }

    function draw() {
      ctx.clearRect(0, 0, w, h);
      fireflies.forEach(f => {
        ctx.beginPath();
        ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255,215,0,${f.alpha})`; // v√†ng gold
        ctx.shadowColor = 'rgba(255,215,0,0.8)';
        ctx.shadowBlur = 8;
        ctx.fill();

        f.x += f.dx;
        f.y += f.dy;
        f.alpha += f.da;
        if (f.alpha <= 0 || f.alpha >= 1) f.da *= -1;
        if (f.x < 0 || f.x > w) f.dx *= -1;
        if (f.y < 0 || f.y > h) f.dy *= -1;
      });
      requestAnimationFrame(draw);
    }
    draw();
  });
</script>