---
import { getAllNews } from '../../../data/newsLoader.js';

// Get current language from URL or props
const currentLang = (Astro.props?.lang || Astro.url.pathname.split('/')[1] || 'en') as 'en' | 'vi' | 'ja' | 'ko' | 'es';

// Create URL prefix based on language (English has no prefix)
const urlPrefix = currentLang === 'en' ? '' : `/${currentLang}`;

// Map news data to display format with current language
const allNews = getAllNews();
const news = allNews.map((item: any) => {
  // Fallback to English if translation for current language doesn't exist
  const translation = item.translations[currentLang] || item.translations['en'];
  return {
    id: item.id,
    image: item.mainImage,
    date: item.createdDate,
    title: translation.title,
    desc: translation.shortDescription,
  };
});
---

<section class="py-16 px-6 bg-primary" style="">
  <div class="max-w-7xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold text-center mb-8 font-lora" style="font-family: 'Lora', serif; color: var(--color-black2white);">
      Explore Our Beauty Stories
    </h2>
    <p class="text-base text-center mb-8 max-w-2xl mx-auto font-lora" style="color: var(--color-blacktext2); font-family: 'Lora', serif;">
      Discover our clients' transformation journeys and boost their confidence, stay updated on the latest aesthetic trends, celebrate natural beauty, and enjoy inspiring stories and care tips from our team of experts.
    </p>
    <div class="grid md:grid-cols-2 gap-10">
      <!-- Left Column: Big News -->
      <div class="flex flex-col h-full">
        <a href={`${urlPrefix}/news/${news[0].id}`} class="rounded-2xl overflow-hidden shadow-lg flex flex-col h-full hover:shadow-2xl hover:-translate-y-1 transition duration-200 bg-surface-1 cursor-pointer group">
          <img src={news[0].image} alt={news[0].title} class="w-full h-64 object-cover" />
          <div class="p-6 flex-1 flex flex-col justify-between">
            <h3 class="text-2xl font-bold mb-2 text-on-surface font-lora line-clamp-1 group-hover:text-primary transition-colors" style="font-family: 'Lora', serif;">{news[0].title}</h3>
            <div class="text-sm mb-2 text-on-surface/70">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 inline-block align-middle mr-[3px] relative -translate-y-[2px]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              {news[0].date}
            </div>
            <p class="text-on-surface/70 line-clamp-2">{news[0].desc}</p>
          </div>
        </a>
      </div>
      <!-- Right Column: 3 Small News -->
      <div class="flex flex-col gap-6">
        {news.slice(1, 4).map((item) => (
          <a href={`${urlPrefix}/news/${item.id}`} class="flex rounded-2xl shadow-lg overflow-hidden hover:shadow-2xl hover:-translate-y-1 transition duration-200 bg-surface-1 cursor-pointer group">
            <img src={item.image} alt={item.title} class="w-32 h-full object-cover flex-shrink-0" />
            <div class="p-4 flex flex-col justify-center">
              <h4 class="text-lg font-bold mb-1 text-on-surface font-lora line-clamp-1 group-hover:text-primary transition-colors" style="font-family: 'Lora', serif;">{item.title}</h4>
              <div class="text-xs mb-1 text-on-surface/70">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 inline-block align-middle mr-[3px] relative -translate-y-[2px]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                {item.date}
              </div>
              <p class="text-sm text-on-surface/70 line-clamp-2">{item.desc}</p>
            </div>
          </a>
        ))}
      </div>
    </div>
  </div>
</section>
