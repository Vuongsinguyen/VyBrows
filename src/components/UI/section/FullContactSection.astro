---
// import emailjs from "emailjs-com"; // Đã bỏ EmailJS, dùng API backend

let formRef: HTMLFormElement | null = null;

const sendEmail = async (e: Event) => {
  e.preventDefault();
  const form = document.getElementById('contactForm') as HTMLFormElement;
  if (!form) return;
  const formData = new FormData(form);
  const data: Record<string, string> = {};
  formData.forEach((value, key) => {
    data[key] = String(value);
  });
  try {
    const res = await fetch('/api/sendMail', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    const result = await res.json();
    if (result.success) {
      alert('✅ Gửi thành công!');
      form.reset();
    } else {
      alert('❌ Lỗi: ' + result.error);
    }
  } catch (err) {
    let msg = 'Unknown error';
    if (err instanceof Error) msg = err.message;
    alert('❌ Lỗi: ' + msg);
  }
};

// Attach event listener on client
if (typeof window !== "undefined") {
  window.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById('contactForm');
    if (form) {
      form.addEventListener('submit', sendEmail);
    }
  });
}
---

<section class="pt-16 pb-8 px-4 md:px-0 bg-[#003324]">
  <div class="max-w-7xl mx-auto">

    <!-- Heading của section -->
    <h2
      class="text-4xl md:text-5xl font-extrabold text-center mb-8 font-lora tracking-tight"
      style="color: var(--color-black2white); font-family: 'Lora', serif;"
    >
      Contact Us
    </h2>

    <!-- Thông tin liên hệ: nằm ngang, có icon -->
    <div class="w-full mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-[#003324] text-white rounded-2xl text-base items-start">
        <div class="flex flex-col gap-4">
          <div class="border border-white/20 rounded-xl px-4 py-3 flex items-center">
            <span class="inline-flex items-center justify-center w-12 h-12 rounded-full border border-white/80 mr-3" style="border-width:1px; background:transparent;">
              <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20" style="color: var(--color-black2white);">
                <path d="M10 2C6.13 2 3 5.13 3 9c0 5.25 7 11 7 11s7-5.75 7-11c0-3.87-3.13-7-7-7zm0 9.5A2.5 2.5 0 1 1 10 6a2.5 2.5 0 0 1 0 5.5z"/>
              </svg>
            </span>
            <div>
              <div class="font-bold text-lg mb-1">Address:</div>
              <div>13192 Bellaire Blvd #B, Houston, TX 77072</div>
            </div>
          </div>
          <div class="border border-white/20 rounded-xl px-4 py-3 flex items-center">
            <span class="inline-flex items-center justify-center w-12 h-12 rounded-full border border-white/80 mr-3" style="border-width:1px; background:transparent;">
              <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20" style="color: var(--color-black2white);">
                <path d="M2 3.5A1.5 1.5 0 0 1 3.5 2h13A1.5 1.5 0 0 1 18 3.5v13a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 2 16.5v-13zm2 0v13h12v-13H4zm6 2a1 1 0 0 1 1 1v1h2a1 1 0 1 1 0 2h-2v2a1 1 0 1 1-2 0v-2H6a1 1 0 1 1 0-2h2V6a1 1 0 0 1 1-1z"/>
              </svg>
            </span>
            <div>
              <div class="font-bold text-lg mb-1">Phone:</div>
              <div>346-409-9999 | 346-409-8888 <span class="text-sm">(English Speaker)</span></div>
            </div>
          </div>
        </div>
        <div class="flex flex-col gap-4">
          <div class="border border-white/20 rounded-xl px-4 py-3 flex items-center">
            <span class="inline-flex items-center justify-center w-12 h-12 rounded-full border border-white/80 mr-3" style="border-width:1px; background:transparent;">
              <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 36 30" style="color: var(--color-black2white);">
                <path d="M36.1714 4.4374C36.1714 2.4574 34.5514 0.837402 32.5714 0.837402H3.77145C1.79145 0.837402 0.171448 2.4574 0.171448 4.4374V26.0374C0.171448 28.0174 1.79145 29.6374 3.77145 29.6374H32.5714C34.5514 29.6374 36.1714 28.0174 36.1714 26.0374V4.4374ZM32.5714 4.4374L18.1714 13.4374L3.77145 4.4374H32.5714ZM32.5714 26.0374H3.77145V8.0374L18.1714 17.0374L32.5714 8.0374V26.0374Z" />
              </svg>
            </span>
            <div>
              <div class="font-bold text-lg mb-1">Email:</div>
              <div>contact@vybrows-academy.com</div>
            </div>
          </div>
          <div class="border border-white/20 rounded-xl px-4 py-3 flex items-center">
            <span class="inline-flex items-center justify-center w-12 h-12 rounded-full border border-white/80 mr-3" style="border-width:1px; background:transparent;">
              <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20" style="color: var(--color-black2white);">
                <path d="M6 2a1 1 0 0 0-1 1v2h10V3a1 1 0 0 0-1-1H6zm-1 5v9a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V7H5zm2 2h6v2H7V9z"/>
              </svg>
            </span>
            <div>
              <div class="font-bold text-lg mb-1">Open Hours:</div>
              <div class="flex gap-4 flex-wrap">
                <span>Mon – Fri: 10:00 – 18:00</span>
                <span>Sat &amp; Sun: 10:00 – 17:00</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="flex flex-col md:flex-row items-stretch gap-[34px]">
      <!-- Google Map -->
      <div class="w-full md:w-1/2 my-6 md:my-8 rounded-2xl shadow-lg bg-[var(--color-card-bg)] overflow-hidden">
        <iframe
          class="w-full h-64 md:h-[500px] object-cover"
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3465.546055721214!2d-95.61564448830596!3d29.703937974993018!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8640ddecac735047%3A0xa513ff1ff0b5ffe8!2sVyBrows%20Academy!5e0!3m2!1sen!2s!4v1755529433006!5m2!1sen!2s"
        <form
          id="contactForm"
          class="px-4 py-8 flex flex-col gap-4"
        >
        ></iframe>
      </div>

      <!-- Contact Form -->
      <div class="w-full md:w-1/2 my-6 md:my-8 mx-0 rounded-2xl shadow-lg bg-[var(--color-card-bg)]">
        <form
          id="contactForm"
          class="px-4 py-8 flex flex-col gap-4"
        >
          <h3 class="text-2xl font-bold mb-1 text-center font-lora"
              style="color: var(--color-text);">
            Contact Us
          </h3>
          <div class="text-sm text-center mb-4" style="color: var(--color-text-secondary);">
            We will get back to you asap!
          </div>

          <!-- Name -->
          <input
            type="text"
            name="name"
            placeholder="Please enter your Name"
            required
            class="pl-10 pr-3 py-2 rounded border-gray-200 w-full"
            style="background: var(--color-input-bg); color: var(--color-text); border-color: var(--color-input-border);"
          />
          <!-- Email -->
          <input
            type="email"
            name="email"
            placeholder="Please enter your Email"
            required
            class="pl-10 pr-3 py-2 rounded border-gray-200 w-full"
            style="background: var(--color-input-bg); color: var(--color-text); border-color: var(--color-input-border);"
          />
          <!-- Phone -->
          <input
            type="tel"
            name="phone"
            placeholder="Please enter your Phone number"
            required
            class="pl-10 pr-3 py-2 rounded border-gray-200 w-full"
            style="background: var(--color-input-bg); color: var(--color-text); border-color: var(--color-input-border);"
          />
          <!-- Services -->
          <select
            name="service"
            required
            class="pl-10 pr-3 py-2 rounded border-gray-200 w-full appearance-none"
            style="background: var(--color-input-bg); color: var(--color-text); border-color: var(--color-input-border);"
          >
            <option value="" disabled selected>Select our Signature Services</option>
            <option value="brows">Brows</option>
            <option value="lips">Lips</option>
            <option value="training">Training</option>
          </select>

          <!-- Submit -->
          <button
            type="submit"
            class="mx-auto inline-flex items-center justify-center px-6 rounded font-semibold font-lora transition mt-2"
            style="background: #003324; color: var(--color-black2white); font-family: 'Lora', serif; height: 50px;"
          >
            Submit your Information!
          </button>

          <div class="text-sm text-center mt-2" style="color: var(--color-text-secondary);">
            You may also call us at (346)-409-9999
          </div>
        </form>
      </div>
    </div>
  </div>
</section>