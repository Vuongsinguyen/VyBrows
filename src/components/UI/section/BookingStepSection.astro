---
// BookingStepSection.astro - Multi-step booking UI
import { useState } from 'react';
---
<section id="booking-step-section" class="booking-step-section max-w-2xl mx-auto py-16 px-4 bg-white rounded-2xl shadow-lg">
  <h2 class="text-3xl font-bold mb-8 text-center text-[#003324] font-lora">Booking Services Step by Step</h2>
  <div id="booking-steps" class="w-full relative" style="min-height:480px;">
    <!-- Stepper UI -->
    <div class="flex justify-between mb-8">
      <div class="step-indicator step-1">1. Select Service</div>
      <div class="step-indicator step-2">2. Date & Time</div>
      <div class="step-indicator step-3">3. Personal Info</div>
      <div class="step-indicator step-4">4. Confirm</div>
    </div>
    <!-- Step 1: Select Service -->
    <div class="step step-1">
      <label class="block mb-2 font-semibold">Category</label>
      <select class="field-input mb-4" id="category">
        <option value="">Select Category</option>
        <option value="pmu">PMU</option>
        <option value="skincare">Skincare</option>
        <option value="detox">Detox & Herbal Hair Wash</option>
      </select>
      <label class="block mb-2 font-semibold">Service</label>
      <select class="field-input mb-4" id="service">
        <option value="">Select Service</option>
        <option value="pmu1">Shading Ombré ($100) - 60min</option>
        <option value="pmu2">Micro Blading ($120) - 75min</option>
        <option value="skin1">Acne Treatment ($80) - 50min</option>
        <option value="detox1">Herbal Hair Wash ($60) - 40min</option>
      </select>
      <button class="next-btn px-6 py-2 bg-[#003324] text-white rounded-lg font-bold mt-4">Next</button>
    </div>
    <!-- Step 2: Select Date Time -->
    <div class="step step-2">
      <label class="block mb-2 font-semibold">Select Date</label>
      <input type="text" class="field-input mb-4" id="date" placeholder="Pick a date" />
      <label class="block mb-2 font-semibold">Select Time</label>
      <input type="time" class="field-input mb-4" id="time" />
      <button class="prev-btn px-4 py-2 bg-gray-200 text-[#003324] rounded-lg font-bold mr-2">Back</button>
      <button class="next-btn px-6 py-2 bg-[#003324] text-white rounded-lg font-bold">Next</button>
    </div>
    <!-- Step 3: Personal Info -->
    <div class="step step-3">
      <label class="block mb-2 font-semibold">Full Name</label>
      <input type="text" class="field-input mb-4" id="name" placeholder="Your Name" />
      <label class="block mb-2 font-semibold">Phone</label>
      <input type="text" class="field-input mb-4" id="phone" placeholder="Phone Number" />
      <label class="block mb-2 font-semibold">Email</label>
      <input type="email" class="field-input mb-4" id="email" placeholder="Email" />
      <button class="prev-btn px-4 py-2 bg-gray-200 text-[#003324] rounded-lg font-bold mr-2">Back</button>
      <button class="next-btn px-6 py-2 bg-[#003324] text-white rounded-lg font-bold">Next</button>
    </div>
    <!-- Step 4: Confirm -->
    <div class="step step-4">
      <h3 class="text-xl font-bold mb-4">Confirm Booking</h3>
      <div class="mb-4" id="confirm-info">
        <!-- Thông tin booking sẽ được render ở đây -->
      </div>
      <button class="prev-btn px-4 py-2 bg-gray-200 text-[#003324] rounded-lg font-bold mr-2">Back</button>
      <button class="submit-btn px-6 py-2 bg-[#e7d48e] text-[#003324] rounded-lg font-bold">Confirm & Book</button>
    </div>
    <div id="booking-status" class="mt-6 text-center font-semibold"></div>
  </div>
</section>

<style>
  .booking-step-section { position: relative; overflow: hidden; }
  .step { position: absolute; left: 0; top: 0; width: 100%; min-height: 480px; background: #fff; z-index: 1; opacity: 0; pointer-events: none; transition: opacity .35s, transform .35s; transform: translateX(40px); }
  .step.active { opacity: 1; pointer-events: auto; transform: translateX(0); z-index: 2; }
  .step.exit-left { opacity: 0; transform: translateX(-40px); }
  .step.exit-right { opacity: 0; transform: translateX(40px); }
  .step-indicator { font-weight:600; color:#e7d48e; padding:4px 12px; border-radius:8px; background:#003324; }
  .step-indicator.active { background:#e7d48e; color:#003324; }
  .field-input { width:100%; padding:.55rem 1rem; border:1px solid #c4d5cf; border-radius:.65rem; background:#eef3f1; color:#003324; font-size:16px; line-height:1.4; margin-bottom:8px; }
</style>
<link rel="stylesheet" href="/node_modules/flatpickr/dist/flatpickr.min.css" />
<script src="/node_modules/flatpickr/dist/flatpickr.min.js"></script>
<script is:inline>
(function(){
  let currentStep = 1;
  const steps = Array.from(document.querySelectorAll('.step'));
  const indicators = Array.from(document.querySelectorAll('.step-indicator'));
  function showStep(n, direction) {
    steps.forEach((s,i)=>{
      s.classList.remove('active','exit-left','exit-right');
      if(i===n-1) {
        s.classList.add('active');
      } else if(i< n-1 && direction==='next') {
        s.classList.add('exit-left');
      } else if(i> n-1 && direction==='back') {
        s.classList.add('exit-right');
      }
    });
    indicators.forEach((ind,i)=>ind.classList.toggle('active',i===n-1));
    currentStep = n;
  }
  document.addEventListener('DOMContentLoaded',()=>{
    showStep(1);
    document.querySelectorAll('.next-btn').forEach(btn=>btn.addEventListener('click',()=>{
      if(currentStep<4) showStep(currentStep+1,'next');
    }));
    document.querySelectorAll('.prev-btn').forEach(btn=>btn.addEventListener('click',()=>{
      if(currentStep>1) showStep(currentStep-1,'back');
    }));
    // Khởi tạo flatpickr cho trường date
    if(window.flatpickr){
      flatpickr('#date', {
        minDate: 'today',
        dateFormat: 'Y-m-d',
        disableMobile: true
      });
    }
  });
})();
</script>
